#!/bin/sh

#STYLESHEET=/home/teastep/Shorewall/docbook-xsl-1.62.4//xhtml/docbook.xsl
STYLESHEET=/usr/share/xml/docbook/stylesheet/nwalsh/xhtml/docbook.xsl
WEBSITE=/home/teastep/Shorewall/Website

list_search() # $1 = element to search for , $2-$n = list
{
    local e
    e=$1

    while [ $# -gt 1 ]; do
	shift
	[ "x$e" = "x$1" ] && return 0
    done

    return 1
}

if [ $# -eq 0 ]; then
    echo "Usage: $(basename $0) <XML file> ..."
    exit 2
fi

while [ $# -gt 0 ]; do

    case $1 in
	*.xml)
	    b=${1%.*}.html

	    f="$WEBSITE/$b"

	    echo "Converting $1 from XML to HTML ($b) ..."

	    if xsltproc --output $f --stringparam html.stylesheet html.css --stringparam ulink.target _self -param toc.section.depth 3 $STYLESHEET $1 ; then
		filestocopy="$filestocopy $f"
	    fi
	    ;;

	*)
	    filestocopy="$filestocopy $1"
	    ;;
    esac

    shift

done

DESTS="
webadmin@mail.shorewall.net:/srv/www/html/3.0/manpages/
"

if [ -n "$filestocopy" ]; then
    for f in $filestocopy; do
	filestoreport="$filestoreport $(basename $f)"
    done

    chmod 664 $filestocopy
    for d in $DESTS; do
	echo "$filestoreport -> $d"
	scp -qp $filestocopy $d
    done
fi


